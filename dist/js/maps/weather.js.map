{"version":3,"names":[],"mappings":"","sources":["weather.js"],"sourcesContent":["// 0. Получаем даты на пять дней\r\n$('#but1').append(moment().format().substr(0,10));\r\n$('#but2').append(moment().add(1, 'days').format().substr(0,10));\r\n$('#but3').append(moment().add(2, 'days').format().substr(0,10));\r\n$('#but4').append(moment().add(3, 'days').format().substr(0,10));\r\n$('#but5').append(moment().add(4, 'days').format().substr(0,10));\r\n\r\n// 1. Получаем координаты месторасположения клиента с помощью метода .geolocation.getCurrentPosition()\r\nvar getPosition = function (opt) {\r\n    return new Promise(function (resolve, reject) {navigator.geolocation.getCurrentPosition(resolve, reject, opt)})};\r\ngetPosition({enableHighAccuracy: false, timeout: 5000}).then(function(position){let crd=position.coords;\r\n    getData(crd.latitude, crd.longitude );\r\n    setInterval(function(){getData(crd.latitude, crd.longitude )},180000)})\r\n    .catch(function(err){alert('Сбой геолокации, время ожидания вышло')});\r\n\r\n// 2. Получаем объект с сервера\r\nfunction getData (lat, long){\r\n    return new Promise(function(resolve, reject){\r\n        $.ajax({\r\n            url: 'http://api.openweathermap.org/data/2.5/forecast?lat='+lat+'&lon='+long+'&APPID=102809fad29396a87de9299cf09c4e31'\r\n        }).done(function (result){resolve(renderData(result))})\r\n            .fail(function (error){reject(alert('Данные о погоде с сервера не получены'))})\r\n    })}\r\n// 3. Рендерим данные по дивам:\r\nfunction renderData(dat) {\r\n// Название населённого пункта\r\n    let cit= $('<h3>').text(dat.city.name);\r\n    $('.tabs').empty().append(cit);\r\n    //данные о погоде\r\n    var dataWeath = dat.list;\r\n    var a=$('.tabset a');\r\n    $.each(a, function(){ let dat= this.innerHTML; let hr= this.hash;\r\n        $.each(dataWeath, function(){\r\n            if(this.dt_txt.substr(0,10)==dat) {\r\n                let div = $('<div class=\"boxes\">');\r\n                let time = $('<h3>');\r\n                $(time).text(this.dt_txt.slice(10));\r\n                let temp = $('<h1>');\r\n                $(temp).text(Math.round(this.main.temp - 273.15));\r\n                let pres = $('<h2>');\r\n                $(pres).text('Давление:');\r\n                let pr = $('<h3>');\r\n                $(pr).text(this.main.pressure + ' ' + 'Па');\r\n                let wi = $('<h2>');\r\n                $(wi).text('Ветер:');\r\n                let win = $('<h3>');\r\n                $(win).text(this.wind.speed + 'км/ч' + ' ' + Math.round(this.wind.deg) + 'deg.');\r\n                let we = $('<h2>');\r\n                $(we).text('Осадки:');\r\n                let wea = $('<h3>');\r\n                $(wea).text(this.weather[0].description);\r\n                $(div).append(time, temp, pres, pr, wi, win, we, wea);\r\n                $(hr).append(div);\r\n            }})})}\r\n// 4. Функция переключения tab..\r\nvar buttons = $(\".tabset a\");\r\nvar currentTab = $(buttons.filter(\".active\").attr(\"href\"));\r\nbuttons.each(function(){\r\n    let tabId = $(this).attr(\"href\");\r\n    $(tabId).css(\"display\",\"none\")});\r\ncurrentTab.css(\"display\",\"block\");\r\n\r\n$('.tabs-holder ul').click(function(event) {\r\n    if ($(event.target).hasClass(\"active\")) {return;}\r\n    buttons.removeClass(\"active\");\r\n    $(event.target).addClass(\"active\");\r\n    currentTab.fadeOut(300, function () {currentTab = $($(event.target).attr(\"href\"));\r\n        currentTab.fadeIn();\r\n    })});\r\n\r\n"],"file":"../weather.js"}